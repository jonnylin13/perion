<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>packages/net/src/parser.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module-@perion_calc.HyperStats.html">HyperStats</a><ul class='methods'><li data-type='method'><a href="module-@perion_calc.HyperStats.html#.from">from</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyAll">applyAll</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyArcaneForce">applyArcaneForce</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyBonusExp">applyBonusExp</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyBossDmg">applyBossDmg</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyCrit">applyCrit</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyCritDmg">applyCritDmg</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyDmg">applyDmg</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyIgnoreDef">applyIgnoreDef</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyMagicAtt">applyMagicAtt</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyMaxDF">applyMaxDF</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyMaxHp">applyMaxHp</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyMaxMp">applyMaxMp</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyMaxTF">applyMaxTF</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyPureStats">applyPureStats</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyStance">applyStance</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyStatusResist">applyStatusResist</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#applyWeaponAtt">applyWeaponAtt</a></li><li data-type='method'><a href="module-@perion_calc.HyperStats.html#get">get</a></li></ul></li><li><a href="module-@perion_core.Cast.html">Cast</a><ul class='methods'><li data-type='method'><a href="module-@perion_core.Cast.html#.from">from</a></li><li data-type='method'><a href="module-@perion_core.Cast.html#float32">float32</a></li><li data-type='method'><a href="module-@perion_core.Cast.html#float64">float64</a></li><li data-type='method'><a href="module-@perion_core.Cast.html#int8">int8</a></li><li data-type='method'><a href="module-@perion_core.Cast.html#int16">int16</a></li><li data-type='method'><a href="module-@perion_core.Cast.html#int32">int32</a></li><li data-type='method'><a href="module-@perion_core.Cast.html#int64">int64</a></li><li data-type='method'><a href="module-@perion_core.Cast.html#short">short</a></li><li data-type='method'><a href="module-@perion_core.Cast.html#uint8">uint8</a></li><li data-type='method'><a href="module-@perion_core.Cast.html#uint16">uint16</a></li><li data-type='method'><a href="module-@perion_core.Cast.html#uint32">uint32</a></li><li data-type='method'><a href="module-@perion_core.Cast.html#ushort">ushort</a></li></ul></li><li><a href="module-@perion_crypto.AES.html">AES</a><ul class='methods'><li data-type='method'><a href="module-@perion_crypto.AES.html#._morph">_morph</a></li><li data-type='method'><a href="module-@perion_crypto.AES.html#.morphIV">morphIV</a></li><li data-type='method'><a href="module-@perion_crypto.AES.html#.scaleIV">scaleIV</a></li><li data-type='method'><a href="module-@perion_crypto.AES.html#_getPacketLength">_getPacketLength</a></li><li data-type='method'><a href="module-@perion_crypto.AES.html#_transform">_transform</a></li><li data-type='method'><a href="module-@perion_crypto.AES.html#getPacketHeader">getPacketHeader</a></li><li data-type='method'><a href="module-@perion_crypto.AES.html#transform">transform</a></li></ul></li><li><a href="module-@perion_crypto.Shanda.html">Shanda</a><ul class='methods'><li data-type='method'><a href="module-@perion_crypto.Shanda.html#.decrypt">decrypt</a></li><li data-type='method'><a href="module-@perion_crypto.Shanda.html#.encrypt">encrypt</a></li><li data-type='method'><a href="module-@perion_crypto.Shanda.html#.rol">rol</a></li><li data-type='method'><a href="module-@perion_crypto.Shanda.html#.ror">ror</a></li></ul></li><li><a href="module-@perion_net.Encoder.html">Encoder</a><ul class='methods'><li data-type='method'><a href="module-@perion_net.Encoder.html#.decode">decode</a></li><li data-type='method'><a href="module-@perion_net.Encoder.html#.encode">encode</a></li></ul></li><li><a href="module-@perion_net.Parser.html">Parser</a><ul class='methods'><li data-type='method'><a href="module-@perion_net.Parser.html#ascii">ascii</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#bool">bool</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#byte">byte</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#char">char</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#collect">collect</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#double">double</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#int">int</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#long">long</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#mapleascii">mapleascii</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#nullascii">nullascii</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#pos">pos</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#read">read</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#seek">seek</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#short">short</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#skip">skip</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#ubyte">ubyte</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#uint">uint</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#ulong">ulong</a></li><li data-type='method'><a href="module-@perion_net.Parser.html#ushort">ushort</a></li></ul></li><li><a href="module-@perion_net.Writer.html">Writer</a><ul class='methods'><li data-type='method'><a href="module-@perion_net.Writer.html#ascii">ascii</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#bool">bool</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#buffer">buffer</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#byte">byte</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#dynamicAlloc">dynamicAlloc</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#int">int</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#long">long</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#mapleascii">mapleascii</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#nullascii">nullascii</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#pos">pos</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#short">short</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#ubyte">ubyte</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#uint">uint</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#ulong">ulong</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#ushort">ushort</a></li><li data-type='method'><a href="module-@perion_net.Writer.html#write">write</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-@perion_calc.html">@perion/calc</a></li><li><a href="module-@perion_core.html">@perion/core</a></li><li><a href="module-@perion_crypto.html">@perion/crypto</a></li><li><a href="module-@perion_net.html">@perion/net</a></li><li><a href="module-@perion_perion.html">@perion/perion</a></li><li><a href="module-@perion_wz.html">@perion/wz</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">packages/net/src/parser.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Parses binary packet Buffers in little endian
 * @class
 * @memberof module:@perion/net
 */
 class Parser {
  /**
   * @constructor
   * @param {Buffer} data The input data Buffer
   */
  constructor(data) {
    this.data = data;
    this.offset = 0;
    this.parsed = [];
  }
  /**
   * Reads a byte
   * @return {Parser} Returns a reference to the current Parser
   */
  byte() {
    const byte = this.data.readIntLE(this.offset, 1);
    this.offset += 1;
    this.parsed.push(byte);
    return this;
  }
  /**
   * Reads a boolean
   * @return {Parser} Returns a reference to the current Parser
   */
  bool() {
    const bool = this.readByte();
    this.parsed.push(bool === 1 ? true : false);
    return this;
  }
  /**
   * Reads an unsigned byte
   * @return {Parser} Returns a reference to the current Parser
   */
  ubyte() {
    const uByte = this.data.readUIntLE(this.offset, 1);
    this.offset += 1;
    this.parsed.push(uByte);
    return this;
  }
  /**
   * Reads a short
   * @return {Parser} Returns a reference to the current Parser
   */
  short() {
    const uByte = this.data.readUIntLE(this.offset, 1);
    this.offset += 1;
    this.parsed.push(uByte);
    return this;
  }
  /**
   * Reads an unsigned short
   * @return {Parser} Returns a reference to the current Parser
   */
  ushort() {
    const uShort = this.data.readUInt16LE(this.offset);
    this.offset += 2;
    this.parsed.push(uShort);
    return this;
  }
  /**
   * Reads a character
   * @return {Parser} Returns a reference to the current Parser
   */
  char() {
    this.parsed.push(String.fromCharCode(97 + this.readShort()));
    return this;
  }
  /**
   * Reads an integer
   * @return {Parser} Returns a reference to the current Parser
   */
  int() {
    const int = this.data.readInt32LE(this.offset);
    this.offset += 4;
    this.parsed.push(int);
    return this;
  }
  /**
   * Reads an unsigned integer
   * @return {Parser} Returns a reference to the current Parser
   */
  uint() {
    const uInt = this.data.readUInt32LE(this.offset);
    this.offset += 4;
    this.parsed.push(uInt);
    return this;
  }
  /**
   * Reads a long
   * @return {Parser} Returns a reference to the current Parser
   */
  long() {
    const long = this.data.readBigInt64LE(this.offset);
    this.offset += 8;
    this.parsed.push(long);
    return this;
  }
  /**
   * Reads an unsigned long
   * @return {Parser} Returns a reference to the current Parser
   */
  ulong() {
    const uLong = this.data.readBigUInt64LE(this.offset);
    this.offset += 8;
    this.parsed.push(uLong);
    return this;
  }
  /**
   * Reads a double
   * @return {Parser} Returns a reference to the current Parser
   */
  double() {
    const double = this.data.readDoubleLE(this.offset);
    this.offset += 8;
    this.parsed.push(double);
    return this;
  }
  /**
   * Reads an ASCII string
   * @param {number} length Length of the string
   * @return {Parser} Returns a reference to the current Parser
   */
  ascii(length) {
    const stringBuffer = Buffer.alloc(length);
    for (let i = 0; i &lt; length; i++) {
      stringBuffer[i] = this.readByte();
    }
    this.parsed.push(stringBuffer.toString('ascii'));
    return this;
  }
  /**
   * Reads a null terminated ASCII string
   * @return {Parser} Returns a reference to the current Parser
   */
  nullascii() {
    const stringArr = [];
    const done = false; /** eslint */
    while (!done) {
      const byte = this.readByte(); /** Read until 0 */
      if (byte === 0) break;
      stringArr.push(byte);
    }
    return Buffer.from(stringArr).toString('ascii');
  }
  /**
   * Reads a MapleStory ASCII string
   * @return {Parser} Returns a reference to the current Parser
   */
  mapleascii() {
    const length = this.readShort();
    this.parsed.push(this.readAsciiString(length));
    return this;
  }
  /**
   * Reads a position (x, y)
   * @return {Parser} Returns a reference to the current Parser
   */
  pos() {
    const x = this.readShort();
    const y = this.readShort();
    return {x, y};
  }
  /**
   * Reads a specified length
   * @param {number} length
   * @return {Parser} Returns a reference to the current Parser
   */
  read(length) {
    const ret = Buffer.alloc(length);
    for (let i = 0; i &lt; length; i++) {
      ret[i] = this.readByte();
    }
    this.parsed.push(ret);
    return this;
  }
  /**
   * Skips the cursor a specified length
   * @param {number} length
   * @return {Parser} Returns a reference to the current Parser
   */
  skip(length) {
    this.offset += length;
    return this;
  }
  /**
   * Moves the cursor to a specified byte offset
   * @param {number} offset
   * @return {Parser} Returns a reference to the current Parser
   */
  seek(offset) {
    this.offset = offset;
    return this;
  }
  /**
   * Collects the parsed values and maps them to the input array strings
   * Will clear the parsed values
   * @param {Array&lt;string>} fieldNames Names mapped to values
   * @return {Map&lt;string, any>} The object with {name:value}
   */
  collect(fieldNames) {
    if (fieldNames.length !== this.parsed.length) return false;
    const ret = {};
    const length = fieldNames.length;
    for (let i = 0; i &lt; length; i++) {
      ret[fieldNames[i]] = this.parsed[i];
    }
    this.parsed = [];
    return ret;
  }
}
module.exports = Parser;
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Mon Mar 22 2021 05:00:36 GMT-0700 (Pacific Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
